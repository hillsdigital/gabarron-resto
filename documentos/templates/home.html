{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gabarrón Resto</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />


    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
    {% include "navbar.html" %}

    <header class="hero">
        <div class="container hero-content">
            <section id="visor-pdf">
                <canvas id="visor-pdf-canvas"></canvas>
            </section> 
        </div>
    </header>

    {% include "footer.html" %}

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const visorPdf = document.getElementById('visor-pdf');
        const canvas = document.getElementById('visor-pdf-canvas');
        const ctx = canvas.getContext('2d');

        async function mostrarPDF(url) {
            try {
                visorPdf.style.display = 'flex'; // mostrar contenedor

                const loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;

                // Renderizar la primera página
                const page = await pdf.getPage(1);

                // Escala para que el ancho máximo sea 900px o el 100% en móvil
                const viewport = page.getViewport({ scale: 1 });
                let scale = 1;

                if (viewport.width > 900) {
                    scale = 900 / viewport.width;
                }

                const scaledViewport = page.getViewport({ scale: scale });

                canvas.width = scaledViewport.width;
                canvas.height = scaledViewport.height;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: scaledViewport
                };

                await page.render(renderContext).promise;

            } catch (error) {
                console.error('Error cargando PDF:', error);
                visorPdf.style.display = 'none';
                alert('No se pudo cargar el PDF.');
            }
        }

        // Ejemplo de llamada, reemplazá "url_del_pdf" por la URL dinámica que tengas:
        // mostrarPDF("url_del_pdf");
    </script>
</body>
</html>
